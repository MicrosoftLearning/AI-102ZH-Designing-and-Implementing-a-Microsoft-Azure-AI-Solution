---
lab:
    title: '创建问答解决方案'
    module: '模块 6 - 构建 QnA 解决方案'
---

# 创建问答解决方案

最常见的对话方案之一是通过常见问题解答 (FAQ) 知识库提供支持。许多组织将 FAQ 发布为文档或网页，这适用于少量的问答对，但针对大型文档搜索可能很麻烦且十分耗时。

**语言**服务包括问答功能，通过该功能，你能够创建可使用自然语言输入来查询的问答对知识库，该服务通常用作一种资源，机器人可以用它来查找用户提交的问题的答案。

> **备注**：语言服务中的问答功能是 QnA Maker 服务的较新版本，QnA Maker 服务仍作为单独服务提供。

## 克隆本课程的存储库

如果尚未将 **AI-102-AIEngineer** 代码存储库克隆到你要在此实验室中使用的环境，请按照以下步骤克隆它。否则，请在 Visual Studio Code 中打开克隆的文件夹。

1. 启动 Visual Studio Code。
2. 打开面板 (Shift+Ctrl+P) 并运行 **Git: Clone** 命令，将 `https://github.com/MicrosoftLearning/AI-102ZH-Designing-and-Implementing-a-Microsoft-Azure-AI-Solution` 存储库克隆到本地文件夹（具体克隆到哪个文件夹无关紧要）。
3. 克隆存储库后，在 Visual Studio Code 中打开文件夹。
4. 等待其他文件安装完毕，以支持存储库中的 C# 代码项目。

    > **备注**：如果系统提示你添加生成和调试所需的资产，请选择“**以后再说**”。

## 创建语言资源

若要创建和托管问答知识库，Azure 订阅中需要语言服务资源。

1. 打开 Azure 门户 (`https://portal.azure.com`)，使用与你的 Azure 订阅关联的 Microsoft 帐户登录。
2. 选择“**&#65291;创建资源**”按钮，搜索“*语言*”，并创建“**语言服务**”资源。
3. 单击“**自定义问答**”块上的“**选择**”。然后单击“**继续创建资源**”。你需要输入以下设置：
    
    - **订阅**：*你的 Azure 订阅*
    - **资源组**：*选择或创建一个资源组（如果你使用的是受限订阅，则可能无权创建新资源组，在此情况下，可使用一个已提供的资源组）*
    - **区域**：*选择任何可用位置*
    - **名称**：*输入唯一名称*
    - **定价层**：标准 S
    - **Azure 搜索位置**\*：*在与你的语言资源相同的全球区域中选择一个位置*。
    - **Azure 搜索定价层**：免费 (F)（*如果该层级不可用，请选择基本 (B)*）
    - **法律条款**： _同意_ 
    - **负责任的 AI 通知**： _同意_
    
    \*自定义问答使用 Azure 搜索来索引和查询问答知识库。

4. 等待部署完成，然后查看部署详细信息。

## 创建问答项目

如需在语言资源中创建问答知识库，可使用 Language Studio 门户创建问答项目。在本例中，你将创建包含有关 [Microsoft Learn](https://docs.microsoft.com/learn) 的问答知识库。

1. 在新的浏览器选项卡中，前往 *Language Studio* 门户 (`https://language.azure.com`)，并使用与你的 Azure 订阅关联的 Microsoft 帐户登录。
2. 如果系统提示选择一个语言资源，请选择以下设置：
    - **Azure 目录**：包含订阅的 Azure 目录。
    - **Azure 订阅**：你的 Azure 订阅。
    - **语言资源**：你之前创建的语言资源。
3. 如果<u>未</u>提示选择一个语言资源，可能是因为订阅中有多个语言资源；在这种情况下：
    1. 在页面顶部栏上，单击“**设置 (&#9881;)**”按钮。
    2. 在“**设置**”页面上，查看“**资源**”选项卡。
    3. 选择刚创建的语言资源，单击“**切换资源**”。
    4. 在页面顶部，单击“**Language Studio**”，返回 Language Studio 主页。
3. 在门户顶部的“**创建新项**”菜单中，选择“**自定义问答**”。
4. 在“**创建项目**”向导的“**选择语言设置**”页面，选择在此资源中为所有项目设置语言的选项，然后选择“**英语**”作为语言。然后单击“**下一步**”。
5. 在“**输入基本信息**”页面，输入以下详细信息，然后单击“**下一步**”：
    - **名称** LearnFAQ
    - **描述**：Microsoft Learn 的常见问题解答
    - **没有答案返回时的默认回答**：抱歉，我不理解这个问题
6. 在“**查看并完成**”页面上，单击“**创建项目**”。

## 向知识库添加源。

可以从头开始创建知识库，但通常先从现有的 FAQ 页面或文档中导入问答。在这种情况下，你将从 Microsoft learn 的现有常见问题解答页面导入数据，还将导入一些预定义的“聊天”问答以支持常见的对话交流。

1. 在问答项目的“**管理源**”页面的“**&#9547; 添加源**”列表中，选择“**URL**”。然后在“**添加 URL**”对话框中，单击“**&#9547; 添加 URL**”，添加以下 URL，然后单击“**添加全部**”，将其添加到知识库：
    - **名称**：`Learn FAQ Page`
    - **URL**：`https://docs.microsoft.com/en-us/learn/support/faq`
2. 在问答项目的“**管理源**”页面的“**&#9547; 添加源**”列表中，选择“**聊天**”。在“**添加聊天**”对话框中，选择“**友好**”，单击“**添加聊天**”。

## 编辑知识库

你的知识库已填充了 Microsoft Learn FAQ 中的问答对，并补充了一组对话式聊天问答对。可以通过添加更多问答对来扩展知识库。

1. 在 Language Studio 的“**LearnFAQ**”项目中，选择“**编辑知识库**”页面，查看现有的问答对（如果显示一些提示，请阅读并单击“**了解**”以消除提示，或单击“**全部跳过**”）
2. 在知识库中，选择“**&#65291; 添加问题对**”。
3. 在“问题”框中，键入`What is Microsoft certification?`，并按“**Enter**”。
4. 选择“**&#65291; 添加替代措词**”，然后键入`How can I demonstrate my Microsoft technology skills?` 并按“**Enter**”。
5. 在“**回答**”框中，键入`The Microsoft Certified Professional program enables you to validate and prove your skills with Microsoft technologies.` 然后按“**Enter**”，单击“**提交**”，将问题（包括替代措词）和回答添加到知识库。

    在某些情况下，使用户能够跟进回答以创建多回合对话是有意义的，这使用户能够以迭代方式细化问题，从而得到他们所需的回答。

6. 在你输入的关于认证问题的回答下，选择“**&#65291; 添加跟进提示**”。
7. 在“**跟进提示**”对话框中，输入以下设置，然后单击“**添加提示**”：
    - **针对用户的提示中显示的文本**：`Learn more about certification.`
    - 选择“**创建新对的链接**”，输入此文本：`You can learn more about certification on the [Microsoft certification page](https://docs.microsoft.com/learn/certifications/).`
    - **仅显示在上下文流中**：*已选中。此选项可确保仅在原始认证问题的跟进问题的上下文中返回回答。*

## 训练和测试知识库

现在你已有了知识库，接下来可以在 QnA Maker 门户中对它进行测试。

1. 在页面右上角，单击“**保存更改**”。
2. 保存更改后，单击“**测试**”，打开测试窗格。
3. 在测试窗格的顶部，取消选择显示简短回答的选项。然后在底部输入消息`Hello`。应会返回相应的响应。
4. 在测试窗格的底部，输入消息`What is Microsoft Learn?`。应会返回常见问题解答中的适当回答。
5. 输入消息`Thanks!`。应会返回适当的聊天回答。
6. 输入消息`Tell me about certification`。创建的回答应与跟进提示链接一起返回。
7. 选择“**详细了解认证**”跟进提示链接。应会返回带有指向认证页面的链接的跟进回答。
8. 知识库测试完成后，关闭测试窗格。

## 部署和测试知识库

知识库提供了客户端应用程序可以用来回答问题的后端服务。现在，可以准备发布知识库并从客户端访问其 REST 接口了。

1. 在 Language Studio 的“**LearnFAQ**”项目中，选择“**部署知识库**”页面。
2. 在页面顶部，单击“**部署**”。然后单击“**部署**”，确认你希望部署知识库。
3. 部署完成后，单击“**获取预测 URL**”，查看知识库的 REST 终结点，并将其复制到剪贴板（但请勿关闭对话框）。
4. 在 Visual Studio Code 的“**12-qna**”文件夹中，打开“**ask-question.cmd**”。此脚本使用 *Curl* 调用问答终结点的 REST 接口。
5. 在此脚本中，将 *YOUR_PREDICTION_ENDPOINT* 替换为你复制的预测终结点（确保用引号将其引起来）。
6. 返回浏览器，在“**获取预测 URL**”对话框中，注意到示例请求包括 **Ocp-Apim-Subscription-Key** 参数的值，类似于 **ab12c345de678fg9hijk01lmno2pqrs34**。这是资源的授权密钥。将其复制到剪贴板，单击“**了解**”，关闭对话框。
7. 返回 Visual Studio Code，在 **ask-question.cmd** 脚本中将 *YOUR_KEY* 替换为你复制的密钥（确保用引号将其引起来）。
8. 请注意脚本中的 Curl 命令**提交**的问题参数的值是“**什么是学习路径？**”。
9. 验证整个脚本与以下代码类似，然后保存文件。

    ```
    @echo off
    SETLOCAL ENABLEDELAYEDEXPANSION

    rem Set variables
    set prediction_url="https://some-name.cognitiveservices.azure.com/language/......."
    set key="ab12c345de678fg9hijk01lmno2pqrs34"

    curl -X POST !prediction_url! -H "Ocp-Apim-Subscription-Key: !key!" -H "Content-Type: application/json" -d "{'question': 'What is a learning Path?' }"
    ```

10. 在 Visual Studio Code 中，在“Explorer”窗格中右键单击“**ask-question.cmd**”脚本，并选择“**在集成终端中打开**”。
11. 在终端窗格中输入命令 `ask-question.cmd` 以运行脚本并查看服务返回的 JSON 响应，其中应包含对问题“*什么是学习路径*”的恰当回答。

## 为知识库创建机器人

用于从知识库中检索答案的客户端应用程序通常都是机器人。

1. 返回浏览器中的 Language Studio，在“**部署知识库**”页面，选择“**创建机器人**”。这将在新的浏览器标签页中打开 Azure 门户，以便你可以在 Azure 订阅中创建 Web 应用机器人（如果出现系统提示，请登录）。
2. 在 Azure 门户中，使用以下设置创建 Web 应用机器人（其中大多数机器人将会预先填充）：

    *如果缺少某些值，请刷新浏览器。*  

  - **机器人句柄**：*机器人的唯一名称*
  - **订阅**：*你的 Azure 订阅*
  - **资源组**：*包含语言资源的资源组*
  - **位置**：*与文本分析服务相同的位置*。
  - **定价层**： F0
  - **应用名称**： *与自动附加了唯一 ID 和 [*.azurewebsites.net*] 的机器 **人句柄** 相同*
  - **SDK 语言**：*选择 C# 或 Node.js*
  - **QnA 身份验证密钥**：*这应该自动设置为 QnA 知识库的身份验证密钥*
  - **应用服务计划/位置**：*如果存在，可以自动将其设置为合适的计划和位置。如果不存在，请创建一个新计划*
  - **Application Insights**：关闭
  - **Microsoft 应用 ID 和密码**：自动创建应用 ID 和密码。
3. 等待机器人创建完毕。单击“**前往资源**”（或者，在主页上，单击“**资源组**”，打开在其中创建了 Web 应用机器人的资源组并单击它。）
4. 在机器人的边栏选项卡上，查看“**在 Web 聊天中测试**”页面，然后等待直到机器人显示消息“**欢迎使用！**”（初始化可能需要几秒钟的时间）。
5. 使用测试聊天界面确保机器人按预期回答知识库中的问题。例如，尝试提交`What is Microsoft certification?`。

## 更多信息

若要详细了解语言服务中的问答，请参阅[语言服务文档](https://docs.microsoft.com/zh-cn/azure/cognitive-services/language-service/question-answering/overview)。
